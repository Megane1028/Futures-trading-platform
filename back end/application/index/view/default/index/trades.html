<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>{$site.web_name}</title>
	<link rel="stylesheet" type="text/css" href="__MB__/element-ui/lib/theme-chalk/index.css" />
	<link rel="stylesheet" type="text/css" href="__MB__/lib/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="__MB__/css/common.css">
	<link rel="stylesheet" type="text/css" href="__MB__/lib/kline/kline.css">
	<link rel="stylesheet" type="text/css" href="__MB__/css/dataMap.css" />
	<link rel="stylesheet" type="text/css" href="__MB__/css/footer.css" />
	<style>
	    .active{
	        color:#fff !important;
	        background: #588bf7 !important;
	    }
    	.tradeorder-jymode-list-low span {
            padding: 5px 10px;
            font-size: 12px;
            display: inline-block;
            background: #f7f7fa;
            color: #000;
            margin-right: 10px;
            border-radius: 5px;
        }
	    .tradeorder-jymode-list-low{
	        display: flex;
	        flex-direction: row;
	        overflow: scroll;
	    }
	    #bottom{
	        bottom: 50px;
	    }
	    .tradeorder{
	        top: 5%;
	        height: 80%;
	        overflow: scroll;
	    }
	    .red{
	        color: #e43e42 !important;
	    }
	    .fontC{
	        color: #e43e42 !important;
	    }
	    .header{
	        border-bottom: 0;
	    }
	    .CNY ul li p{
	        color: #636e82;
	    }
	    .CNY ul li span{
	        color:#333;
	    }
	    .mydate{
	        color: #3d106d !important;
	        border-bottom: #3d106d !important;
	    }
	    #bottom button:nth-child(2){
	        background: #00c087 !important;
	    }
	    .tradeorder{
	        top:11%;
	        height: auto;
	    }
	    div#bottom button:nth-child(1){
	        background: #e43e42 !important;
	    }
	    .tradeConfirm{
	        position: fixed;
	        width: 100%;
	        height: 100%;
	        background: rgba(0,0,0,0.5);
	    }
	    .tradeConfirm-box{
	        background: #fff;
	        position: fixed;
	        border-radius: 10px;
	        top:11%;
	        width: 80%;
	        margin: 0 10%;
	        z-index: 99;
	    }
	    .trade-border{
	        position: relative;
            height: 150px;
            width: 150px;

            margin: 10px auto;
            background: none;
            box-shadow: none;
            /*border: 10px solid #588bf7;*/
            /*border-radius: 50%;*/
	    }
	    .progress{
	        background-color:#fff;
	    }
	    .progress:after{
		    content: "";
		    width: 100%;
		    height: 100%;
		    border-radius: 50%;
		    border: 10px solid #306ded;
		    position: absolute;
		    top: 0;
		    left: 0;
		}
	    .progress > span{
	        width: 50%;
		    height: 100%;
		    overflow: hidden;
		    position: absolute;
		    top: 0;
		    z-index: 1;
	    }
	    .progress .progress-left{
		    left: 0;
		}
		.progress .progress-bar{
		    width: 100%;
		    height: 100%;
		    background: none;
		    /*border-width: 15px;*/
		    border: 10px solid #d0dfff;
		    /*border-style: solid;*/
		    position: absolute;
		    top: 0;
		}
		.progress .progress-left .progress-bar{
		    left: 100%;
		    border-top-right-radius: 80px;
		    border-bottom-right-radius: 80px;
		    border-left: 0;
		    -webkit-transform-origin: center left;
		    transform-origin: center left;
		  
		   
		}
		.progress .progress-right{
		    right: 0;
		}
		.progress .progress-right .progress-bar{
		    left: -100%;
		    border-top-left-radius: 80px;
		    border-bottom-left-radius: 80px;
		    border-right: 0;
		    -webkit-transform-origin: center right;
		    transform-origin: center right;
		   
		   
		    
		}
		@keyframes loading-1{
		    0%{
		        -webkit-transform: rotate(0deg);
		        transform: rotate(0deg);
		    }
		    100%{
		        -webkit-transform: rotate(180deg);
		        transform: rotate(180deg);
		    }
		}
		
	    .trade-qwe{
	       position: absolute;
            background: #306ded;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            /*margin: 0 58px;*/
            top: 0;
            left:50%;
            transform: translate(-50%,0);
            z-index:100;
	    }
	    .qianlan{
	        color: #62759a;
	    }
	    .trade-txt{
	        text-align: center;
	    }
	    .trade-txt span{
	        color: #588bf7;
	        font-size: 20px;
	        display: block;
	        text-align: center;
	        margin-top: 40px;
	    }
	    .trade-txt article{
	        margin: 5px 0;
	    }
	    .trade-money{
	        text-align: center;
	        margin: 40px 0;
	    }
	    .trade-money aside{
	        color: #588bf7;
	        font-size: 24px;
	        margin-bottom: 5px;
	    }
	    .trade-money article{
	        font-size: 14px;
	    }
	    .tradeorder-top{
			 margin: 5px auto !important;
	    }
.tradeorder-top-list {
    color: #333;
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    padding-bottom: 3px;
}
		.tradeorder-buy {
		    margin-top: 5px;
		}
		.tradeorder-buy h1 {
		    font-size: 16px;
		    color: #62759a;
		    margin-bottom: 0px;
		}
		.tabList{margin:5px auto}
		.tabs{width:15% !important}
		.tabList .tabs span {
		    background: #ededf5;
		    padding: 3px;
		    font-size: 16px;
		    border-radius: 5px;
		    color: #62759a;
		}
		#bottom{height:46px;}
		#bottom button{margin-top:3px}
		#meiqia_custorm{
        left: 70vw;
        top: 80vh;
    }
	</style>
</head>

<body>
	<div id="app" v-cloak>
	    <div class="tradeConfirm" v-show="tradeConfirmbool">
	        <div class="tradeorder-mask"></div>
	        <div class="tradeConfirm-box">
	        <div class="tradeorder-title">
	            <span data-localize="zdy.orderconfirm">订单确认</span>
	            <img src="__MB__/images/ia.png" @click="tradeConfirmClick()">
	        </div>
	        <div class="trade-money" v-if="orderSuccessList.status==3">
	            <aside>{{orderSuccessList.fact_profits>0?"+"+orderSuccessList.fact_profits:orderSuccessList.fact_profits|toFixeds}}</aside>
	            <article data-localize="dqjswc">到期结算完成</article>
	        </div>
	        
	        <div class="trade-border progress"   v-if="orderSuccessList.status==1">
	            <span class="progress-left">
                    <span class="progress-bar" :style="leftProgressStyle"></span>
                </span>
                <span class="progress-right">
                    <span class="progress-bar" :style="rightProgressStyle"></span>
                </span>
                
	            <div class="trade-qwe">
	                
	            </div>
	            <div class="trade-txt">
	                <span>{{countDown(orderSuccessList.endTime,99,orderSuccessList.seconds,orderSuccessList.remain_milli_seconds,orderSuccessList.id) | toFixeds0}}</span>
	                <article data-localize="zdy.xj" class="qianlan">现价</article>
	                <!--<aside :style="orderSuccessList.type==1?'color:#e43e42':'color:#59bb5f'">{{orderSuccessList.open_price | toFixeds}}</aside>-->
	                <aside :style="orderSuccessList.type==1?'color:#e43e42':'color:#59bb5f'">{{newprice |toFixed4}}</aside>
	                
	            </div>
	        </div>
	        
	        <div class="tradeorder-top tradeorder-bili">
	            <div class="tradeorder-top-list">
	                <span class="qianlan" data-localize="zdy.fangxiang">方向</span>
	                <span :style="orderSuccessList.type==1?'color:#e43e42':'color:#59bb5f'">{{orderSuccessList.type==1?getlg('md'):getlg('mk')}}</span>
	            </div>
	            
	            <div class="tradeorder-top-list">
	                <span data-localize="zdy.je" class="qianlan">金额</span>
	                <span class="qianlan">{{orderSuccessList.number}}</span>
	            </div>
	            <div class="tradeorder-top-list">
	                <span class="qianlan" data-localize="zdy.zxj">执行价</span>
	                <span class="qianlan">{{orderSuccessList.open_price | toFixeds}}</span>
	            </div>
	            <div class="tradeorder-top-list" v-if="orderSuccessList.status==1">
	                <span data-localize="contract.estimated" class="qianlan">预计盈亏</span>
	                <span :style="(orderSuccessList.number * orderSuccessList.profit_ratio -0) /100>0?'color:#e43e42':'color:#59bb5f'">{{(orderSuccessList.number * orderSuccessList.profit_ratio -0) /100 || '0.00' | toFixedNum}}</span>
	            </div>
	        </div>
	        <div class="tradeorder-btn"><span data-localize="zdy.jxxd" @click="tradeConfirmCheck()">继续下单</span></div>
	        </div>
	    </div>
	    <div class="tradeorder-box" v-show="tradeOrderBool">
	        <div class="tradeorder-mask">
	    <div class="tradeorder">
	        <div class="tradeorder-title">
	            <span data-localize="zdy.orderconfirm">订单确认</span>
	            <img src="__MB__/images/ia.png" @click="tradeOrderClick()">
	        </div>
	        <div class="tradeorder-top tradeorder-bili">
	            <div class="tradeorder-top-list">
	                <span data-localize="index.name">名称</span>
	                <span>{{currencyTitle
	                }}</span>
	            </div>
	            <div class="tradeorder-top-list">
	                <span data-localize="zdy.fangxiang">方向</span>
	                <span :style="tradeType==1?'color:#e43e42':'color:#59bb5f'">{{tradeBuy}}</span>
	            </div>
	            <div class="tradeorder-top-list">
	                <span data-localize="zdy.xianjia">现价</span>
	                <span>{{newprice | toFixeds}}</span>
	            </div>
	        </div>
	        <!--<div class="tradeorder-jymode tradeorder-bili">-->
	        <!--    <h1>交易模式</h1>-->
	        <!--    <div class="tradeorder-jymode-list">-->
	        <!--        <span v-for="item in tradeCurrency" :class="[{'tradeorder-jymode-active':tradeCurrencyId == item.id}]" @click="tradeCurrencyClick(item.id,item.name)" :key="item.id">{{item.name}}</span>-->
	        <!--    </div>-->
	        <!--</div>-->
	        <div class="tradeorder-time tradeorder-bili">
	            <h1 data-localize="zdy.selecttime">选择到期时间(左滑更多选择)</h1>
	            <div class="tradeorder-time-list">
	                <article v-for="(item,index) in timeList" :class="[{'tradeorder-time-list-active':seconds == item.seconds}]" @click="selectTime(item.seconds,item.profit_ratio)">
	                    <span>{{item.seconds_desc}}</span>
	                    <em>{{item.profit_ratio}}%</em>
	                </article>
	            </div>
	        </div>
	        <div class="tradeorder-buy tradeorder-bili">
	            <h1 >买入金额</h1>
	            <!--<div class="tradeorder-jymode-list-low">-->
	            <!--    <span v-for="item in tradeNUm"  :key="item.id" @click="tabNumbers(item.number)" :class="[{'active':(inputValue-0) == (item.number -0).toFixed(0)}]">{{item.number |toFixedNum}}</span>-->
	            <!--</div>
	            <div class="tradeorder-time-list tabList">
	                <article v-for="item in tabList" class="tabs" :class="[{'tradeorder-time-list-active':tabCurrent == item}]" @click="selectMoney(item)">
	                    <span>{{item}}</span>
	                </article>
	            </div>-->
	       
	            <input type="number" :placeholder="getlg('pbnum')" v-model="inputValue">
	        </div>
	        <div class="tradeorder-balance tradeorder-bili">
	            <span data-localize="zdy.keyongyue">可用余额</span>：{{balance | toFixeds}}
	            &emsp;<span class="text-link pull-right" @click="inputValue = balance">全部金额</span>
	        </div>
	        <div class="tradeorder-btn">
	            <span data-localize="fat.sure" @click="taderSubmit()">确认下单</span>
	        </div>
	    </div>
	    </div>
	    </div>
		<div id="header">
			
			<div  v-if="tradeId">
			<div class='header'>
				<!--<p class="pull-left">-->
				<!--	<img onclick="javascript:history.go(-1);" class="return" src="__MB__/images/return1.png" alt="">-->
				<!--</p>-->
                <span class="contractdetail" data-localize="zdy.huobijiaoyi">貨幣交易</span>
			</div>
			<div style="height:40px"></div>
			</div>
	       <!--<div class="content-tab-box" v-if="tradeId">-->
        <!--        <p data-localize="contract.secondContract" class="active">微合约</p>-->
        <!--        <p data-localize="contract.contract"  @click="buyModals(1)">合约</p>-->
        <!--    </div>-->
			<div class="tabs-data-map-box" :style="tradeId?'margin-top:0;border-bottom:1px solid #eee':''">
			    <span class="tabs-data-map" @click="showLeft">
                	<b class="coinname" v-if="tradeId">{{currencyTitle}}</b>
                	<b class="coinname" v-else>{{currencyTitle}}</b>
                	<img src="__MB__/images/threejiao.png">
                </span>
                <div class="tabs-data-map-box-scan" onclick="window.location.href='{:url('user/orderlist')}'" v-if="tradeId">
                    <img src="__MB__/images/copy_scan_code.png">
                    <span data-localize="contract.chicang">持仓</span>
                </div>
			</div>
			<div class="CNY bgWhite">
				<div class="pull-left">
				    <h5 style="margin-top: 15px;" :style="tradeId?'color:#4e5b85':''" data-localize="zdy.current">当前</h5>
					<h2 :class="['new-price',{'red': newprice>0}]">{{newprice | toFixed4}}</h2>
					<h4 class="flex alcenter">
						<span style="margin-left:5px;margin-top:5px"
							:class="['updown',{'red': updown>0}]">{{updown | toFixeds}}%</span>
					</h4>
				</div>
				<ul class="pull-right ft12 ">
					<li class="flex">
						<p data-localize="mk.high">高</p><span class="max-price">{{maxprice | toFixeds}}</span>
					</li>
					<li class="flex">
						<p data-localize="mk.low">低</p><span class="min-price">{{minprice | toFixeds}}</span>
					</li>
					<li class="flex">
						<p data-localize="mk.open">开盘</p><span class="min-price">{{msgopenprice | toFixeds}}</span>
					</li>
					<li class="flex">
						<p data-localize="index.vol">24H量</p><span class="dayVom">{{dayvom | toFixeds}}</span>
					</li>
				</ul>

			</div>
		</div>
		<div id="tv_chart_container" style="width:100%;height:55.0vh;margin-top: 5px;padding-bottom: 10px;"></div>
		<!--订单列表 -->
		<div class="order-list" v-show="tradeId">
			<p v-show="false">{{CountDown}}</p>
			<!--<div class="flex order-list-header between">-->
			<!--	<p class="tc" :class="[{'active':status == 1}]" @click="selectOrder(1)" data-localize="contract.positionList">持仓列表</p>-->
			<!--	<p class="tc" :class="[{'active':status == -1}]" @click="selectOrder(-1)" data-localize="td.drecord">订单记录</p>-->
			<!--</div>-->

			<ul class="lists">
				<li class="flex between ft10">
					<p data-localize="assets.num">数量</p>
					<p data-localize="contract.purchasePrice">购买价</p>
					<p v-show="status == 1"  data-localize="deals.nowprice">{{getlg('tnowprice')}}</p>
					<p v-show="status == -1" data-localize="contract.transactionPrice">成交价</p>
					<p v-show="status == 1" data-localize="contract.estimated">预计盈亏</p>
					<p v-show="status == -1" data-localize="deals.fee">手续费</p>
					<p v-show="status == 1" data-localize="contract.countDown">倒计时(s)</p>
					<p v-show="status == -1" data-localize="contract.profitAndLoss">盈亏</p>
				</li>
				<!-- v-if="orderList.length > 0 && item.remain_milli_seconds >0 && status==1 || status ==-1 && orderList.length >0||item.status==3 && orderList.length >0" -->
				<li
					v-if="orderList.length > 0 && item.remain_milli_seconds >0 && status==1 || status ==-1 && orderList.length >0||item.status==3 && orderList.length >0"
					v-for="(item,index) in orderList" :key="item.id" class="flex between ft10">
					<!-- <p :class="item.type == 1?'green':'red'">{{item.number || '0' | toFixedNum}}{{item.currency_name}}</p> -->
					<p v-if="item.is_insurance == 1">{{item.number || '0' | toFixedNum}}{{getlg('just')}}</p>
					<p v-else-if="item.is_insurance == 2">{{item.number || '0' | toFixedNum}} {{getlg('back')}}</p>
					<p v-else>{{item.number || '0' | toFixedNum}}</p>
					<p>{{item.open_price || '0.00' | toFixed4}} <img v-if="item.type == 1" width="10" src="__MB__/images/buy.png" alt="">
						<img v-else width="10" src="__MB__/images/sell.png" alt=""></p>
					<p v-if="status == 1&&item.status == 1">{{newprice || '0.00' | toFixed4}}</p>
					<p v-if="status == 1&&item.status == 3">{{item.end_price || '0.00' | toFixed4}}</p>
					<p v-if="status == -1&&item.remain_milli_seconds>0">--</p>
					<p v-if="status == -1&&item.remain_milli_seconds<=0">{{item.end_price || '0.00' | toFixed4}}</p>
					<p v-if="status == 1&&item.status == 1 && (item.open_price -0) == (newprice -0)" class="green">0</p>
					<p v-if="status == 1&&item.status == 1 && item.type == 1 && (item.open_price -0) > (newprice -0)" class="red">
						-{{item.number || '0' | toFixedNum}}</p>
					<p v-if="status == 1&&item.status == 1 && item.type == 1 && (item.open_price -0) < (newprice -0)"
						class="green">
						{{(item.number * item.profit_ratio -0) /100 || '0.00' | toFixedNum}}</p>
					<p v-if="status == 1&&item.status == 1 && item.type == 2 && (item.open_price -0) > (newprice -0)"
						class="green">
						{{(item.number * item.profit_ratio -0) /100 || '0.00' | toFixedNum}}</p>
					<p v-if="status == 1&&item.status == 1 && item.type == 2 && (item.open_price -0) < (newprice -0)" class="red">
						-{{(item.number -0) || '0.00' | toFixedNum}}</p>
					<p v-if="status == 1&&item.status == 3" :class="item.fact_profits >= 0?'green':'red'">
						{{item.fact_profits || '0' | toFixedNum}}</p>
					<p v-if="status == 1&&item.status == 1" class="times">
						{{countDown(item.endTime,index,item.seconds,item.remain_milli_seconds,item.id)}}s</p>
					<p v-if="status == 1&&item.status == 3" class="times">0.0s</p>
					<p v-if="status == -1&&item.remain_milli_seconds>0">--</p>
					<p v-if="status == -1&&item.remain_milli_seconds<=0">{{item.fee || '0.00' | toFixed1}}</p>
					<p v-if="status == -1&&item.remain_milli_seconds>0">--</p>
					<p v-if="status == -1&&item.remain_milli_seconds<=0" :class="item.fact_profits >= 0?'green':'red'">
						{{item.fact_profits || '0' | toFixedNum}}</p>
					<!-- <p v-if="item.status == 3">{{item.fact_profits || '0' | toFixedNum}}</p> -->
				</li>
			</ul>
			<div v-if="orderList.length == 0" class="tc mt10" data-localize="transaction.nodata">暂无记录</div>
		</div>
		<div style="height:160px;"></div>

		<div id="bottom" class="flex between" v-if="tradeId">
			<!--<div class="flex bottom-left between" @click="slectedTime()">-->
			<!--	<div class="tc">-->
			<!--		<p data-localize="assets.num">数量</p>-->
			<!--		<p class="ftColor">{{inputValue || '0.00' | toFixedNum}}</p>-->
			<!--	</div>-->
			<!--	<div class="tc">-->
			<!--		<p data-localize="assets.time">时间</p>-->
			<!--		<p class="ftColor">{{seconds || '00'}}s</p>-->
			<!--	</div>-->
			<!--	<div class="tc">-->
			<!--		<p data-localize="contract.profitRate">盈利率</p>-->
			<!--		<p class="ftColor">{{profitRatio || '00' | toFixedNum}}%</p>-->
			<!--	</div>-->
			<!--	<div class="logo-down">-->
			<!--		<img src="__MB__/images/downs.png" alt="">-->
			<!--	</div>-->
			<!--</div>-->
			<div class="flex">
				<button class="second-buy" @click="buyModal(1)" data-localize="contract.buyUp">买多</button>
				<button class="second-sell" @click="buyModal(2)" data-localize="contract.buyAll">买空</button>
			</div>

		</div>
		<div id="bottom" class="flex between" v-else>
			<button class="goTranbuy" @click="buyModals(1)" data-localize="transaction.buy">买入</button>
			<button class="goTransell" @click="buyModals(2)" data-localize="transaction.sell">卖出</button>
		</div>
		<div id="sideColumn" class="bgColor" v-if="tradeId">
			<h4>
			</h4>
			<div class="ft20 bold bdb pl20 texts-lever" data-localize="zdy.huobixiangqing">货币详情</div>
			<ol class="tabs hide">
				<li class="currency_name side side2" data-id="3">USDT</li>
			</ol>
			<ul class="ul">
				<li v-for="item in currencyList" :key="item.id" @click="selectCurrencys(item.codename)">
					<strong><span>{{item.title}}</span></strong>
					<p :class="['gre',{'fontC':item.price>0}]">
						<!--<span>{{item.now_price * item.rmb_relation | toFixeds}}<b>{{item.legal_name=='USDT'?'RMB':item.legal_name}}</b></span>-->
						<span><b>{{item.price}}</b></span>
					</p>
				</li>
			</ul>
		</div>
		



		<!-- 倒计时下单弹窗 -->
		<div class="time-modal">
			<div class="time-header">
				<div>
					<p class="colorGrey ft12" data-localize="contract.transactionMode">交易模式</p>
					<div class="flex warps1 currency-list mt10">
						<p :class="[{'active':tradeCurrencyId == item.id}]" v-for="item in tradeCurrency" :key="item.id"
							@click="tradeCurrencyClick(item.id,item.name)">{{item.name}}</p>

					</div>

				</div>

			</div>
			<div class="time-content mt10">
				<p class="colorGrey ft12" data-localize="contract.openQuantity">开仓数量</p>
				<div class="time-num between">
					<ul class="flex warps1">
						<li v-for="item in tradeNUm" :key="item.id" @click="tabNumbers(item.number)">
							<p :class="[{'active':(inputValue-0) == (item.number -0).toFixed(0)}]">{{item.number |toFixedNum}}</p>
						</li>
					</ul>
					<input type="number" data-localize="contract.otherQuantities" placeholder="其他数量" v-model="inputValue">
				</div>
				<!-- <div class="flex between balances ft12">
					<p>余额：{{balance}}</p>
					<p><span data-localize="deals.fee">手续费</span>：{{rate}}%</p>
				</div> -->

				<div class="time-list">
					<p class="colorGrey ft12" data-localize="deals.optime">开仓时间</p>
					<div class="flex warps1 currency-list mt10">
						<p :class="[{'active':seconds == item.seconds}]" v-for="item in timeList" :key="item.id"
							@click="selectTime(item.seconds,item.profit_ratio)">{{item.seconds}}s</p>

					</div>
				</div>
				<!-- <div class="flex around">
					<p>盈利率</p>
					<p class="ft20 bold green">{{profitRatio | toFixedNum}}%</p>

				</div> -->
				<div class="flex between ft14">
					<p><span data-localize="contract.accountBalance">账户余额</span>: <span class="green bold">{{balance}} {{tradeCurrencyName}}</span></p>
					<p><span data-localize="contract.profitRate">盈利率</span>: <span class="green bold ft20">{{profitRatio | toFixedNum}}%</span></p>

				</div>

				<!-- <div class="time-btn flex between">
					<button class="second-buy bgGreen" @click="buyModal(1)">买涨</button>
					<button class="second-sell bgRed" @click="buyModal(2)">买跌</button>
				</div> -->
				<!-- <div class="flex jucenter ft12 yellowColor">
					<p>预期收益：{{inputValue * profitRatio + (inputValue - 0) || '0.00' | toFixeds1}}</p>
					<p class="ml10">保底金额：{{guaranteeAmount}}</p>
				</div> -->
			</div>
		</div>

		<!-- 下单之后的弹窗 -->
		<div class="orders">
			<div>
				<div class="mt20 orders-list">
					<p class="mt10">
						<span data-localize="assets.num">数量</span>：
						<span>{{inputValue || '0' | toFixedNum}} {{tradeCurrencyName}}</span>
					</p>
					<p class="mt10">
						<span data-localize="assets.time">时间</span>：
						<span>{{seconds}} S</span>
					</p>
					<p class="mt10">
						<span data-localize="contract.profitRate">盈利率</span>：
						<span>{{profitRatio}}%</span>
					</p>
				</div>
			</div>
		</div>
		<div id="mask1" @click="closeLeft"></div>
        <div style="height:50px;"></div>
	    <footer>
	            <a href="index.html" {if condition="$current eq 'index'"}class="select"{/if}>
	                <div>
	                    <p class="img img0"></p>
	                    <span data-localize="footer.home">首页</span>
	                </div>
	            </a>
	            
	            <a href="{:url('index/market')}" {if condition="$current eq 'market'"}class="select"{/if}>
	                <div>
	                    <p class="img img1"></p>
	                    <span data-localize="footer.quotation">行情</span>
	                </div>
	            </a>
	             <a href="{:url('index/trades')}"  {if condition="$current eq 'trades'"}class="select"{/if}>
	                <div>
	                    <p class="img img2"></p>
	                    <span data-localize="footer.transaction">交易</span>
	                </div>
	            </a>
	            <a href="{:url('user/wallet')}"  {if condition="$current eq 'wallet'"}class="select"{/if}>
	                <div>
	                    <p class="img img3"></p>
	                    <span data-localize="footer.assets">资产</span>
	                </div>
	            </a>
	            <a href="{:url('user/user')}"  {if condition="$current eq 'user'"}class="select"{/if}>
	                <div>
	                    <p class="img img4"></p>
	                    <span data-localize="footer.personal">我的</span>
	                </div>
	            </a>
	        </footer>
	</div>


	<script type="text/javascript" src="__MB__/lib/vue.min.js"></script>
	<script type="text/javascript" src="__MB__/lib/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="__MB__/javascripts/jquery.cookie.js"></script>
	<script type="text/javascript" src="__MB__/lib/layer_mobile/layer.js"></script>
	<script type="text/javascript" src="__MB__/element-ui/lib/index.js"></script>
	<script type="text/javascript" src="__MB__/javascripts/socket.io.js"></script>
	<script type="text/javascript" src="__MB__/tradeview/charting_library/charting_library.min.js"></script>
	<script type="text/javascript" src="__MB__/lib/jquery.localize.min.js"></script>
	<script type="text/javascript" src="__MB__/lib/language_cookie.js"></script>
	<script type="text/javascript" src="__MB__/javascripts/main.js?2020"></script>
	<script type="text/javascript" src="__MB__/javascripts/dataMap.js"></script>
	<script>
		var ATMExQuoteChart = {
			__state: function () {
				this._widget = null;
				this._position_line = null;
				this._last_order_id = null
			},
			set_position_line: function (c, a) {
				var b = ATMExQuoteChart.__state;
				if (b._widget) {
					if (!b._position_line) {
						b._position_line = b._widget.chart().createPositionLine().setPrice(a).setQuantity(null).setText(a)
					} else {
						b._position_line.setPrice(a)
					}
					b._last_order_id = c
				}
			},
			remove_position_line: function (c) {
				var b = ATMExQuoteChart.__state;
				var a = b._position_line;
				if (a && b._last_order_id === c) {
					b._position_line = null;
					a.remove()
				}
			}
		}
		
		var vm = new Vue({
			el: '#app',
			data: {
			    tradeConfirmbool:false,
			    rmb:7,
			    tabIndex:0,
			    pkList:[],
			    tradeOrderBool:false,
			    msgopenprice:"",
				widget: null,
				symbolInfo: null,
				feed: null,
				wsEx: null,
				ws: null,
				lists: [],
				newData: '',
				symbol: 'ETH/USDT',
				priceScale: 10000,
				histime: '',
				newprice: '0.00',
				updown: '0.00',
				maxprice: '0.00',
				minprice: '0.00',
				dayvom: '0.00',
				currencyList: [],
				couponSelected: '',
				heyueId:get_param('heyueId'),
				legal_id: get_param('legal_id'),
				currency_id: get_param('currency_id'),
				tradeId: 1,
				sellType: 'buy',
				multipleList: [],
				legal_name: '',
				CountDown: '',
				balance: '',
				rate: '',
				numbers: '0.00',
				expectedReturn: '0.00',
				guaranteeAmount: '0.00',
				tradeType: '',
				tradeCurrency: [],
				tradeCurrencyId: '',
				tradeCurrencyName: '',
				tradeCurrencyData: [],
				tradeNUm: [],
				timeList: [],
				seconds: '',
				inputValue: 100,
				profitRatio: '',
				tradeCurrencyIdTest: '',
				secondsTest: '',
				inputValueTest: '',
				profitRatioTest: '',
				balanceTest: '',
				rateTest: '',
				orderData: {

				},
				progress: 100,
				set: null,
				status: 1,
				currencyName: "",
				orderList: [],
				tabList:['10', '20', '50', '100', '200', '500'],
				tabCurrent:'',
				orderSuccessList:[],
				set: null,
				secods: '',
				bmbBalance: '',
				sets: null,
				insurancType: [],
				userInsurancId: '',
				tradeBuy:"",
				coinType:'',
				// ATMExQuoteChart: {},

			},
			filters: {
			    toFixeds0: function (value) {
					var vals = iTofixed(value,0);
					return vals;
				},
				toFixeds: function (value) {
					var vals = iTofixed(value,2);
					return vals;
				},
				toFixeds1: function (value) {
					var vals = iTofixed(value,8);
					return vals;
				},
				toFixed4: function (value) {
					var vals = iTofixed(value,4);
					return vals;
				},
				toFixedNum: function (value) {
					var vals = iTofixed(value,0);
					return vals;
				},
				toFixed1: function (value) {
					var vals = iTofixed(value,1);
					return vals;
				}
			},
			created() {
				var that = this;
				var paramsed = get_all_params();
				that.symbol = paramsed.symbol;
				
				var arr = that.symbol.split('/');
				that.coinType = arr[0];
				that.currencyName = that.symbol;
				that.init();
				setInterval(function(){
				    that.init();
				},1000)
				
			},
			computed: {
			    currencyTitle(){
			        for(let i =0;i<this.currencyList.length;i++){
			            if(this.currencyList[i].codename==this.symbol){
			                return this.currencyList[i].title
			            }
			        }
			    },
				listenState() { //监听交易对
					return this.symbol;
				},
				leftProgressStyle(){
				    // console.log('计算left',this.seconds>0&&this.orderSuccessList.status==1)
				    if(this.seconds>0&&this.orderSuccessList.status==1){
				        let ss = this.seconds / 2;
				        // console.log({animation: `loading-1 ${ss}s linear forwards ${ss}s`})
				        return {animation: `loading-1 ${ss}s linear forwards ${ss}s`}
				    }else{
				        return ;
				    }
				},
				rightProgressStyle(){
				    // console.log('计算right')
				    if(this.seconds>0&&this.orderSuccessList.status==1){
				        let ss = this.seconds / 2;
				        return {animation: `loading-1 ${ss}s linear forwards`}
				    }else{
				        return ;
				    }
				}
			},
			watch: {
				listenState: function (a, b) { //监听交易对
					if (a != b && b != '') {
						this.widget.setSymbol(a, localStorage.getItem('tim'), function onReadyCallback() {}) //切换币种
					}
				}
			},
			mounted() {
			    let that=this;
			    /* initDataToken({
			        url:"user/rmb",
			    },function(res){
			        that.rmb=res?res:7;
			    }); */
				this.createWidget();
			
				// this.connects();
				this.getList();

			},
			destroyed() {
				this.removeWidget();
			},
			beforeDestroy() {

			},

			methods: {
			    tradeConfirmCheck(){
			      this.tradeConfirmbool=!this.tradeConfirmbool;
                    this.tradeOrderBool=!this.tradeOrderBool;  
			    },
			    tradeConfirmClick(){
			        this.tradeConfirmbool=!this.tradeConfirmbool
			    },
			    tradeOrderClick(){
			        this.tradeOrderBool=!this.tradeOrderBool;
			    },
				init() {
					var that = this;
					
					initDatas({
				           url: 'api/ajax',
				           data: {
				        	   request:'getQuotation'
				           },
				           type: 'post'
				       }, function (res) {
				           if (res.status == 1) {
				        	   var data = res.data;
				        	   that.currencyList = data;
				        	   
				           } else {
				               layer_msg(res.msg);
				           }
				       });
					
	
					initDatas({
				           url: 'api/ajax',
				           data: {
				        	   request:'getStockInfo',
				        	   type:this.coinType,
				           },
				           type: 'post'
				       }, function (res) {
				           if (res.status == 1) {
				        	   var data = res.data;
				        	   var zf = (data.price - data.open_price)*100/data.open_price;
				        	   that.timeList = data.timeList;
				        	   if(that.seconds == ''){
				        	       that.seconds = that.timeList[0].seconds;
				        	       that.profitRatio = that.timeList[0].profit_ratio;
				        	   }
				        	   that.newprice = data.price;
				        	   that.maxprice = data.price_high;
				        	   that.minprice = data.price_low;
				        	   that.msgopenprice = data.open_price;
				        	   that.updown = zf.toFixed(2);
				        	   that.dayvom = data.vol;
				           } else {
				               layer_msg(res.msg);
				           }
				       });
					
					
					
					
				},
				getList() {
					var that = this;
					that.orderList = [];
					var arr = [];
					clearTimeout(that.set);
					clearInterval(that.sets);
					
					initDatas({
						url: 'user/ajax',
						data: {
							request:'newOrderList',
							page: 1,
							status: that.status,
							limit: 100,
							type:this.coinType,
							match_id: that.tradeId
						}
					}, function (res) {
						if (res.status) {
							arr = res.data;
							if (arr.length > 0) {
								that.orderSuccessList = arr[0];
								that.orderList = arr;
								that.Djs_time();
								that.set = setTimeout(that.countDown, 200);
							} else {
								that.orderSuccessList = [];
								that.orderList = [];
							}

						}
					});
					
					
				},
				// 订单倒计时
				countDown(val, indexs, seconds, relSeconds, ids) {
					var that = this;
					that.secods = relSeconds;
					var timeValue = '';
					var process = 100 / Number(seconds);
					var endItem = val; //获取列表传的截止时间
					var nowItem = new Date().getTime(); //获取当前时间
					var timeSpace = Number(endItem) - Number(nowItem); //截止时间减去当前时间
					var seconds = '';
		
					if (timeSpace > 0) {
						seconds = iTofixed(timeSpace / 1000,1);
						return seconds;
					} else if (timeSpace <= 0) {
						
						// 倒计时结束打开
						//ATMExQuoteChart.remove_position_line(ids);
						//that.getList();
						// 或者刷新页面
						// location.reload();
						
                        if(indexs==99){
                        	
                        	initDataToken({
                                url:"user/ajax",
                                data:{
                                	request:'getTradeList',
                                    id:ids,
                                },
                            },function(res){
                            	if (res.data.length > 0) {
                            		clearTimeout(that.set);
                            		that.orderSuccessList = res.data[0];
                            	}
                            });
                        	
                            
                            return 0;
                            
                            
                            
                        }
                        

					}



				},
				Djs_time: function () {
					this.sets = setInterval(() => {
						var presentTime = new Date().getTime();
						this.CountDown = presentTime
					}, 200);
				},
				// 选择微合约订单类型
				selectOrder(types) {
					var that = this;
					that.status = types;
					that.orderList = [];
					that.getList();
				},
				selectCurrencys(currencyName) {
					var that = this;
					that.tradeId = 'ids';
					that.legal_id = 'legalId';
					that.currency_id = 'currencyId';
					that.symbol = currencyName;
					that.currencyName = currencyName;
					that.legal_name = 'legalName';
					var info = currencyName.split('/');
					that.coinType = info[0];
					$('#mask1').hide();
					$('#sideColumn').animate({
						left: '-70%'
					}, 100);
					that.init();
					that.createWidget();
					// that.connects();
					that.getList();

				},
				tradeCurrencyClick(num, names) {
					var that = this;
					that.tradeCurrencyId = num;
					that.tradeCurrencyName = names;
					for (var i = 0; i < that.tradeCurrency.length; i++) {
						if (that.tradeCurrency[i].id == num) {
							that.tradeNUm = that.tradeCurrency[i].micro_numbers;
							if (that.tradeCurrency[i].user_wallet) {
								that.balance = that.tradeCurrency[i].user_wallet.micro_with_insurance;
							}
							that.rate = that.tradeCurrency[i].micro_trade_fee;
							if (that.tradeNUm.length > 0) {
								that.inputValue = iTofixed(that.tradeNUm[0].number,0);
							}
						}
					}
				},
				tabNumbers(num) {
					var that = this;
					that.inputValue = iTofixed(num,0);
				},
				// 显示左侧
				showLeft() {
					var that = this;
					$('#mask1').show();
					$('#sideColumn').animate({
						left: '0'
					}, 100);
				},
				// 关闭左侧
				closeLeft() {
					var that = this;
					$('#mask1').hide();
					$('#sideColumn').animate({
						left: '-70%'
					}, 100);
				},


				// 买入/卖出按钮点击
				buyModal(types) {
					var that = this;
					that.progress = 100;
					layer.closeAll();
					clearInterval(that.set);
					that.tradeType = types;
					var text1 = '';
					var skin = 'confirm-modal btn-text ';
					var text2 = '';
					if (types == 1) {
					    that.tradeBuy=getlg('md');
						text1 = getlg('md') + that.currencyName;
						text2 = getlg('md') + that.tradeCurrencyName;
						skin = 'confirm-modal btn-text buys';
					} else {
					    that.tradeBuy=getlg('mk');
						text1 = getlg('mk') + that.currencyName;
						text2 = getlg('mk') + that.tradeCurrencyName;
						skin = 'confirm-modal btn-text sells';
					}
					this.tradeOrderBool=true;
					if(this.tradeNUm.length){
					    this.inputValue=iTofixed(this.tradeNUm[0].number,0);
					}
				// 	layer.open({
				// 		type: 1,
				// 		title: text1,
				// 		area: ['90%', 'auto'],
				// 		skin: skin,
				// 		content: $('.orders'),
				// 		shadeClose: true,
				// 		btn: [getlg('ceil'), text1],
				// 		btn2: function (index) {
				// 			that.taderSubmit()
				// 		},
				// 		success: function () {

				// 		}
				// 	})
				},
				slectedTime() {
					var that = this;
					that.progress = 100;
					layer.closeAll();
					clearInterval(that.set);
					layer.open({
						type: 1,
						// title: '',
						title: false,
						shadeClose: true,
						area: ['100%', 'auto'],
						skin: 'confirm-modal btn-text second-modal',
						content: $('.time-modal'),
						shadeClose: true,
						fixed: true,
						offset: 'b',
						closeBtn: 0,
						// scrollbar: false,
						tipsMore: true,
						btn: [getlg('md'), getlg('mk')],
						btn2: function (index) {
							that.buyModal(2);
						},
						yes: function () {
							that.buyModal(1)
						}
					})
				},
				// 下单
				taderSubmit() {
					
					var that = this;
					if (!that.seconds) {
						layer_msg(getlg('chooseTime'));
						return false;

					}
					if (!that.inputValue) {
						layer_msg(getlg('selectQuantities'));
						return false;
					} 
					
					if (that.inputValue <= 0) {
						layer_msg(getlg('purchase'));
						return false;
					} 
					
					
				    var amount = that.inputValue;
					initDatas({
						url: 'user/ajax',
						data: {
							request:'microtrade',
							match_id: that.tradeId,
							currency_id: that.coinType,
							type: that.tradeType,
							seconds: that.seconds,
							number: that.inputValue
						},
						type: 'post'
					}, function (res) {
						if (res.status) {
						    that.tradeConfirmbool = !that.tradeConfirmbool;
						    that.tradeOrderBool=!that.tradeOrderBool;
				            that.inputValue='';
				            that.balance = res.balance;
							layer_msg(getlg('checkoutSuccess'));
							
							// that.orderList = [];
							clearTimeout(that.set);
							clearInterval(that.sets);
							// // $('.order-lists').html('');
							// $('.order-lists .times').text('');
							that.getList();
						} else {
							if (getlg(res.msg))
								layer_msg(getlg(res.msg));
							else layer_msg(res.msg);
						}
					})
				},
				selectTime(num, num1) {
					var that = this;
					that.seconds = num;
					that.profitRatio = num1;
				},
				selectMoney(num) {
					var that = this;
					that.inputValue = num;
				},
				// 合约跳转
				buyModals(types) {
					var that = this;
					let heyueId=that.heyueId || that.tradeId;
					location.href = 'LeveragedDeals.html?heyueId='+heyueId+'&id1=' + that.legal_id + '&id2=' + that.currency_id + '&name1=' + that
						.legal_name + '&name2=' + that.currencyName + '&type=' + types;
				},
				insure1(ids) {
					location.href = "exchange.html?type=insurance&insuranceType=" + ids;
				},
				// insure2() {
				// 	location.href = "exchange.html?type=insurance&insuranceType=2";
				// },
				// 默认
				connect(real) { //封装推送数据
					var that = this;
				    
					

					initDatas({
						url: 'user/ajax',
						data:{
							request:'info'
						},
					}, function (res) {
						if (res.status) {
							
							that.balance = res.balance;
							
							
							
							
							
							var socketio = io(socket_api);
							socketio.emit('kline_type', that.coinType);
							
							socketio.on('kline', function (msg) {

								if (that.coinType == msg.code) {
									var types = localStorage.getItem('type');
									
									if (types == msg.type) {
										//console.log(msg);
										let obj = {}
								        //console.log(types);
										obj.open = Number(msg.open);
										obj.low = Number(msg.low);
										obj.high = Number(msg.high);
										obj.close = Number(msg.close);
										obj.volume = Number(msg.volume);
										obj.time = Number(msg.time);
										real(obj);
										
										that.msgopenprice = Number(msg.stock.open_price);
										that.newprice = msg.stock.price;
										that.updown = msg.stock.price_zf;
										that.maxprice = msg.stock.price_high;
										that.minprice = msg.stock.price_low;
										that.msgopenprice = msg.stock.open_price;
										that.dayvom = msg.stock.vol;
										
									}
									
									
									
								}
								
								
							});
							/* 
							socketio.on('daymarket', function (msg) {
								if (msg.type == 'daymarket') {
									let obj = {}
									if (that.symbol == msg.symbol) {

								// 		that.maxprice = msg.high *that.rmb
								// 		that.minprice = msg.low *that.rmb
									that.maxprice = msg.high 
										that.minprice = msg.low
										that.dayvom = iTofixed(msg.volume,4);
										that.updown = msg.change;
									}
								}
							});
							socketio.on('closed_microorder', function (msg) {

								if (msg.type == 'closed_microorder') {
									var datas = msg.data;
									for (var i = 0; i < that.orderList.length; i++) {
										if (that.orderList[i].id == datas.id) {
											that.orderList[i] = datas;
											setTimeout(function () {
												var arr = that.orderList;
												arr.splice(i, 1)
												that.orderList = arr;
											}, 500)

											return false;
										}
									}


								}
							}); */
							
							
							

						}
					});
					
					
					
				},
				connects() { //封装推送数据
					var that = this;
			
					var socketio = io(socket_api)
					var socket_user_id = (new Date()).getTime();
					socketio.emit('login', socket_user_id);
					socketio.on('daymarket', function (msg) {
						if (msg.type == 'daymarket') {
							let obj = {}
							if (that.symbol == msg.symbol) {

								that.maxprice = msg.high
								that.minprice = msg.low
								that.dayvom = iTofixed(msg.volume,4);
								that.updown = msg.change;
							}
						}
					});
				},
				createWidget() {
					let _this = this;
                    
					this.$nextTick(function () {
						let widget = _this.widget = new TradingView.widget({
							symbol: _this.symbol,
							interval: 1,
							debug: true,
							fullscreen: false,
							autosize: true,
							container_id: "tv_chart_container",
							// datafeed: new Datafeeds.UDFCompatibleDatafeed("http://demo_feed.tradingview.com"),
							datafeed: _this.createFeed(),
							library_path: "/template/mb/tradeview/charting_library/",
							custom_css_url: 'bundles/new.css',
							locale: "zh",
							width: "100%",
							height: 516,
							drawings_access: {
								type: 'black',
								tools: [{
									name: "Regression Trend"
								}]
							},
							disabled_features: [ //  禁用的功能
								'left_toolbar', 'widget_logo', 'header_saveload', 'compare_symbol', 'display_market_status',
								'go_to_date', 'header_chart_type', 'header_compare', 'header_interval_dialog_button',
								'header_resolutions', 'header_screenshot', 'header_symbol_search', 'header_undo_redo',
								'legend_context_menu', 'show_hide_button_in_legend', 'show_interval_dialog_on_key_press',
								'snapshot_trading_drawings', 'symbol_info', 'timeframes_toolbar',
								'use_localstorage_for_settings',
								'volume_force_overlay'
							],
							enabled_features: [ //  启用的功能（备注：disable_resolution_rebuild 功能用于控制当时间范围为1个月时，日期刻度是否都是每个月1号
								'dont_show_boolean_study_arguments', 'hide_last_na_study_output', 'move_logo_to_main_pane',
								'same_data_requery', 'side_toolbar_in_fullscreen_mode', 'disable_resolution_rebuild'
							],
							charts_storage_url: 'http://saveload.tradingview.com',
							charts_storage_api_version: "1.1",
							toolbar_bg: "transparent",
							timezone: "Asia/Shanghai",
							studies_overrides: {
								'volume.precision': '1000'
							},
							overrides: _this.overrides()
						});

						widget.MAStudies = [];
						widget.selectedIntervalButton = null;
						ATMExQuoteChart.__state._widget = widget;
						// widget.setLanguage('en')
						widget.onChartReady(function () { //图表方法
							// document.getElementById('trade-view').childNodes[0].setAttribute('style', 'display:block;width:100%;height:100%;');
							//let that =this
							widget.chart().createStudy('Moving Average', false, false, [15, 'close', 0], null, {
								'Plot.color': '#a039a2'
							},{checkLimit:true});
							widget.chart().createStudy("Moving Average", false, false, [10, 'close', 0], null, {
								'Plot.color': 'green'
							},{checkLimit:true});
							widget.chart().createStudy("Moving Average", false, false, [20, 'close', 0], null, {
								'Plot.color': 'red'
							},{checkLimit:true});
							
							let buttonArr = [{
									value: "1",
									period: "1s",
									text: getlg('klineText1'),
									chartType: 3,
									type:"1min"
								},
								{
									value: "1",
									period: "1m",
									text: getlg('klineText2'),
									chartType: 1,
									type:"1min"
								},
								{
									value: "5",
									period: "5m",
									text: getlg('klineText3'),
									chartType: 1,
									type:"5min"
								},
								{
									value: "30",
									period: "30m",
									text: getlg('klineText5'),
									chartType: 1,
									type:"30min"
								},
								{
									value: "60",
									period: "60min",
									text: getlg('klineText6'),
									chartType: 1,
									type:"60min"
								},
								{
									value: "1D",
									period: "1D",
									text: getlg('klineText7'),
									chartType: 1,
									type:"1day"
								}
							];
							let btn = {};
							let nowTime = '';
							buttonArr.forEach((v, i) => {
								let button = widget.createButton()
								button.attr('title', v.text)
									.addClass("my2")
									.text(v.text)
								
								if (v.text == getlg('klineText2')) {
							
									button.css({
										'color': '#3d106d',
										'border-bottom': '1px solid #3d106d'
									})
									localStorage.setItem('tim', '1') //默认为1分钟
									localStorage.setItem('type', '1min')
								}
								btn = button.on("click", function (e) {
									$(this).parents(".left").children().find(".my2").removeAttr("style"); //去掉1分钟的
									handleClick(e, v.value,v.type);

									widget.chart().setChartType(v.chartType); //改变K线类型
								});


							});
							let handleClick = (e, value,type) => {
								_this.setSymbol = function (symbol, value) {
									gh.chart().setSymbol(symbol, value);
								};
								localStorage.setItem('tim', value);
								localStorage.setItem('type', type);
								widget.chart().setResolution(value, function onReadyCallback() {}); //改变分辨率

								$(e.target)
									.addClass("mydate")
									.closest("div.space-single")
									.siblings("div.space-single")
									.find("div.button")
									.removeClass("mydate")
							};

						});


						_this.widget = widget;
					})
				},
				createFeed() {
					let this_vue = this;
					let Datafeed = {};


					Datafeed.DataPulseUpdater = function (datafeed, updateFrequency) {
						this._datafeed = datafeed;
						this._subscribers = {};

						this._requestsPending = 0;
						var that = this;

						var update = function () {
							if (that._requestsPending > 0) {
								return;
							}

							for (var listenerGUID in that._subscribers) {
								var subscriptionRecord = that._subscribers[listenerGUID];
								var resolution = subscriptionRecord.resolution;

								var datesRangeRight = parseInt((new Date().valueOf()) / 1000);


								//	BEWARE: please note we really need 2 bars, not the only last one
								//	see the explanation below. `10` is the `large enough` value to work around holidays
								var datesRangeLeft = datesRangeRight - that.periodLengthSeconds(resolution, 10);

								that._requestsPending++;

								(function (_subscriptionRecord) { // eslint-disable-line
									that._datafeed.getBars(_subscriptionRecord.symbolInfo, resolution, datesRangeLeft,
										datesRangeRight,
										function (bars) {
											that._requestsPending--;

											//	means the subscription was cancelled while waiting for data
											if (!that._subscribers.hasOwnProperty(listenerGUID)) {
												return;
											}

											if (bars.length === 0) {
												return;
											}
											var lastBar = bars[bars.length - 1];
											if (!isNaN(_subscriptionRecord.lastBarTime) && lastBar.time < _subscriptionRecord
												.lastBarTime) {
												return;
											}

											var subscribers = _subscriptionRecord.listeners;

											//	BEWARE: this one isn't working when first update comes and this update makes a new bar. In this case
											//	_subscriptionRecord.lastBarTime = NaN
											var isNewBar = !isNaN(_subscriptionRecord.lastBarTime) && lastBar.time >
												_subscriptionRecord.lastBarTime;

											//	Pulse updating may miss some trades data (ie, if pulse period = 10 secods and new bar is started 5 seconds later after the last update, the
											//	old bar's last 5 seconds trades will be lost). Thus, at fist we should broadcast old bar updates when it's ready.
											if (isNewBar) {
												if (bars.length < 2) {
													throw new Error(
														'Not enough bars in history for proper pulse update. Need at least 2.');
												}

												var previousBar = bars[bars.length - 2];
												for (var i = 0; i < subscribers.length; ++i) {
													subscribers[i](previousBar);
												}
											}

											_subscriptionRecord.lastBarTime = lastBar.time;

											for (var i = 0; i < subscribers.length; ++i) {
												subscribers[i](lastBar);
											}
										},

										//	on error
										function () {
											that._requestsPending--;
										});
								})(subscriptionRecord);
							}
						};

						if (typeof updateFrequency != 'undefined' && updateFrequency > 0) {
							setInterval(update, updateFrequency);
						}
					};

					Datafeed.DataPulseUpdater.prototype.periodLengthSeconds = function (resolution, requiredPeriodsCount) {
						var daysCount = 0;

						if (resolution === 'D') {
							daysCount = requiredPeriodsCount;
						} else if (resolution === 'M') {
							daysCount = 31 * requiredPeriodsCount;
						} else if (resolution === 'W') {
							daysCount = 7 * requiredPeriodsCount;
						} else {
							daysCount = requiredPeriodsCount * resolution / (24 * 60);
						}

						return daysCount * 24 * 60 * 60;
					};

					Datafeed.DataPulseUpdater.prototype.subscribeDataListener = function (symbolInfo, resolution,
						newDataCallback,
						listenerGUID) {
						this._datafeed._logMessage('Subscribing ' + listenerGUID);

						if (!this._subscribers.hasOwnProperty(listenerGUID)) {
							this._subscribers[listenerGUID] = {
								symbolInfo: symbolInfo,
								resolution: resolution,
								lastBarTime: NaN,
								listeners: []
							};
						}

						this._subscribers[listenerGUID].listeners.push(newDataCallback);
					};

					Datafeed.DataPulseUpdater.prototype.unsubscribeDataListener = function (listenerGUID) {
						this._datafeed._logMessage('Unsubscribing ' + listenerGUID);
						delete this._subscribers[listenerGUID];
					};

					Datafeed.Container = function (updateFrequency) {
					    
						this._configuration = {
							supports_search: false,
							supports_group_request: false,
							supported_resolutions: ['1', '3', '5', '15', '30', '60', '120', '240', '360', '720', '1D', '3D',
								'1W', '1M'
							],
							supports_marks: true,
							supports_timescale_marks: true,
							exchanges: ['gh']
						};

						this._barsPulseUpdater = new Datafeed.DataPulseUpdater(this, updateFrequency || 10 * 1000);
						// this._quotesPulseUpdater = new Datafeed.QuotesPulseUpdater(this);

						this._enableLogging = true;
						this._callbacks = {};

						this._initializationFinished = true;
						this._fireEvent('initialized');
						this._fireEvent('configuration_ready');
					};

					Datafeed.Container.prototype._fireEvent = function (event, argument) {
						if (this._callbacks.hasOwnProperty(event)) {
							var callbacksChain = this._callbacks[event];
							for (var i = 0; i < callbacksChain.length; ++i) {
								callbacksChain[i](argument);
							}

							this._callbacks[event] = [];
						}
					};

					Datafeed.Container.prototype._logMessage = function (message) {
						if (this._enableLogging) {
							var now = new Date();
						}
					};

					Datafeed.Container.prototype.on = function (event, callback) {
						if (!this._callbacks.hasOwnProperty(event)) {
							this._callbacks[event] = [];
						}

						this._callbacks[event].push(callback);
						return this;
					};

					Datafeed.Container.prototype.onReady = function (callback) {
						let that = this;
				// 		if(get_param('tradeId')){
				// 		    $(".order-list li").css('border-bottom','1px solid #4e5b85');
				// 		let iframe=document.getElementsByTagName('iframe')[0];
				// 		iframe.contentWindow.document.getElementsByClassName('chart-page')[0].style.setProperty('background','rgb(19, 31, 48)','important');
				// 		iframe.contentWindow.document.getElementById('loading-indicator').style.setProperty('background','rgb(19, 31, 48)','important');
				// 		iframe.contentWindow.document.getElementsByClassName('js-rootresizer__contents')[0].style.setProperty('background','rgb(19, 31, 48)','important');
					
				// 		setTimeout(function (){
						    
				// 		    iframe.contentWindow.document.getElementsByClassName('chart-container')[0].style.setProperty('background','transparent','important');
				// 		    iframe.contentWindow.document.getElementsByClassName('header-chart-panel-sizer')[0].style.setProperty('background','rgb(19, 31, 48)','important');   
				// 		},100)
				// 		}
						if (this._configuration) { 
							setTimeout(function () {
								callback(that._configuration);
								
							}, 0);
						} else {
							this.on('configuration_ready', function () {
								callback(that._configuration);
								
							});
						}
					};

					Datafeed.Container.prototype.resolveSymbol = function (symbolName, onSymbolResolvedCallback,
						onResolveErrorCallback) {
						 
						this._logMessage("GOWNO :: resolve symbol " + symbolName);
						Promise.resolve().then(() => {


							// this._logMessage("GOWNO :: onResultReady inject "+'AAPL');
							onSymbolResolvedCallback({
								"name": this_vue.symbol,
								"timezone": "Asia/Shanghai",
								"pricescale": this_vue.priceScale,
								"minmov": 1, //minmov(最小波动), pricescale(价格精度), minmove2, fractional(分数)
								"minmov2": 0, //这是一个神奇的数字来格式化复杂情况下的价格。
								"ticker": this_vue.symbol,
								"description": "",
								"type": "bitcoin",
								"volume_precision": 8,
								// "exchange-traded": "sdt",
								// "exchange-listed": "sdt",
								//现在，这两个字段都为某个交易所的略称。将被显示在图表的图例中，以表示此商品。目前此字段不用于其他目的。
								"has_intraday": true,
								"has_weekly_and_monthly": true,
								"has_no_volume": false, //布尔表示商品是否拥有成交量数据。
								'session': '24x7',
								'supported_resolutions': ['1', '3', '5', '15', '30', '60', '120', '240', '360', '720', '1D',
									'3D', '1W',
									'1M'
								]

							});
						})
					};


					//初始化数据
					Datafeed.Container.prototype.getBars = function (symbolInfo, resolution, rangeStartDate, rangeEndDate,
						onHistoryCallback, onErrorCallback) {
						// if (rangeStartDate > 0 && (rangeStartDate + '').length > 10) {
						//   throw new Error(['Got a JS time instead of Unix one.', rangeStartDate, rangeEndDate]);
						// }

						if (resolution.indexOf('D') == -1 && resolution.indexOf('W') == -1 && resolution.indexOf('M') == -1) {
							resolution = resolution + 'min'
						} else if (resolution.indexOf('W') != -1 || resolution.indexOf('M') != -1) {
							resolution = resolution
						}
                        var info = symbolInfo.name.split('/');
						
					    initDatas({
				           url: 'api/ajax',
				           data: {
				        	   'request':'stock',
				        	   'resolution':resolution,
				        	   'from':rangeStartDate,
				        	   'to': rangeEndDate,
				        	   'symbol': info[0]
				           },
				           type: 'post'
    				       }, function (res) {
    				           if (res.status == 1) {  
    							   if(res.data){
    								   res.data.forEach((item, i) => {
    									   item.open = Number(item.open)
    									   item.close = Number(item.close )
    									   item.high = Number(item.high)
    									   item.low = Number(item.low )
    									   item.time = Number(item.time )
    								   });
                                        res.data.pop()
    								   onHistoryCallback(res.data, {
    									   noData: false
    								   })
    								   onHistoryCallback([], {
    									   noData: true
    								   })
    							   }
    
    					       }
    				           if (!res.data || res.code == -1) {
    								onHistoryCallback([], {
    									noData: true
    								})
    							}
    							if (res.data && res.data.length == 0) {
    								onHistoryCallback([], {
    									noData: true
    								})
    							}
    
    			       });
					
				       

					};
					//实时数据
					Datafeed.Container.prototype.subscribeBars = function (symbolInfo, resolution, onRealtimeCallback,listenerGUID, onResetCacheNeededCallback) {
						
						
						if (resolution.indexOf('D') == -1 && resolution.indexOf('W') == -1 && resolution.indexOf('M') == -1) {
							resolution = resolution + 'min'
						} else if (resolution.indexOf('W') != -1 || resolution.indexOf('M') != -1) {
							resolution = resolution
						}
                        var info = symbolInfo.name.split('/');
						
						
    					initDatas({
    						url: 'user/ajax',
    						data:{
    							request:'info'
    						},
    					}, function (res) {
    						if (res.status) {
    							this_vue.balance = res.balance;
    						}
    					});
						
					    setInterval(function(){
					        initDatas({
    				           url: 'api/ajax',
    				           data: {
    				        	   'request':'stock',
    				        	   'resolution':resolution,
    				        	   'symbol': info[0]
    				           },
    				           type: 'post'
        				       }, function (res) {
        				           if (res.status == 1) {  
        							   if(res.data){
        							       
        							       let lastData  = res.data[res.data.length-1]
        							       //lastData['time'] = lastData['time'] + 60*1000
        								  onRealtimeCallback(lastData)
        							   }
        
        					       }
        			       });
					    },1000)
						
						
						
						
						
						
				// 		this_vue.connect(onRealtimeCallback)
						//this._barsPulseUpdater.subscribeDataListener(symbolInfo, resolution, onRealtimeCallback, listenerGUID, onResetCacheNeededCallback);
					};

					Datafeed.Container.prototype.unsubscribeBars = function (listenerGUID) {

						this._barsPulseUpdater.unsubscribeDataListener(listenerGUID);

					};

					return new Datafeed.Container;
				},

				updateWidget(item) {
					this.symbolInfo = {
						name: item,
						ticker: item,
						description: "",
						session: "24x7",
						supported_resolutions: ['1', '5', '30', '60', '240', '1D', '3D', '1W', '1M'],
						has_intraday: true,
						has_daily: true,
						has_weekly_and_monthly: true,
						timezone: "UTC",
					}

					this.removeWidget();
					this.createWidget();
					
				},
				removeWidget() {
					if (this.widget) {
						this.widget.remove();
						this.widget = null;
					}
				},
				overrides() {
				     let style = {
    						up: "#ff3e60",
    						down: "#00c087",
    						bg: "#fff",
    						grid: "#f1f1f1",
    						cross: "#f1f1f1",
    						border: "#f1f1f1",
    						borders: '#4a77ae',
    						text: "#7d818a",
    						// areatop: "rgba(122, 152, 247, 1)",
    						// areadown: "rgba(122, 152, 247, 0.5)"
    						areatop: "#eff9fa",
    						areadown: "#e5ebf4"
    					};   
    				   
				    // let style='';
				    // if(get_param('tradeId')){
				    //     $('.order-list').css('color','#4e5b85');
				    //     $(".lists").css('color','#4e5b85');
				    //     $(".CNY ul li span").css('color',"#cec5c5");
				    //     $(".CNY ul li p").css('color',"#4e5b85");
				    //     $('.tabs-data-map-box-scan span').css('color',"#4e5b85");
			     //   	$(".tabs-data-map img").attr('src','__MB__/images/news/threejiao_white.png')
				    //     $("body").css({'background':"#131f30","color":"#fff"});
    				//     $(".CNY").css('background',"#131f30");
    				//     $("#bottom").css({'background':"#0f2a45","border-top":"0","bottom":"50px"});
    				//     setTimeout(function(){
    				//             let iframe=document.getElementsByTagName('iframe')[0];
    				//         	iframe.contentWindow.document.getElementById('loading-indicator').style.setProperty('background','rgb(19, 31, 48)','important');
    				//     },500)
				    //     style = {
    				// 		up: "#00c087",
    				// 		down: "#ff3e60",
    				// 		bg: "#131f30",
    				// 		grid: "#152741",
    				// 		cross: "#152741",
    				// 		border: "#152741",
    				// 		borders: '#4a77ae',
    				// 		text: "#7d818a",
    				// 		// areatop: "rgba(122, 152, 247, 1)",
    				// 		// areadown: "rgba(122, 152, 247, 0.5)"
    				// 		areatop: "#eff9fa",
    				// 		areadown: "#e5ebf4"
    				// 	};
				    // }else{
				    //     style = {
    				// 		up: "#00c087",
    				// 		down: "#ff3e60",
    				// 		bg: "#fff",
    				// 		grid: "#f1f1f1",
    				// 		cross: "#f1f1f1",
    				// 		border: "#f1f1f1",
    				// 		borders: '#4a77ae',
    				// 		text: "#7d818a",
    				// 		// areatop: "rgba(122, 152, 247, 1)",
    				// 		// areadown: "rgba(122, 152, 247, 0.5)"
    				// 		areatop: "#eff9fa",
    				// 		areadown: "#e5ebf4"
    				// 	};   
				    // }
					return {
						'volumePaneSize': "small", //large, medium, small, tiny
						'paneProperties.topMargin': '20',
						"scalesProperties.lineColor": style.bg,
						"scalesProperties.textColor": style.text,
						"paneProperties.background": style.bg, //改变背景色的重要代码
						"paneProperties.vertGridProperties.color": style.grid,
						"paneProperties.horzGridProperties.color": style.grid,
						"paneProperties.crossHairProperties.color": style.cross,
						"paneProperties.legendProperties.showLegend": true,
						"paneProperties.legendProperties.showStudyArguments": true,
						"paneProperties.legendProperties.showStudyTitles": true,
						"paneProperties.legendProperties.showStudyValues": true,
						"paneProperties.legendProperties.showSeriesTitle": true,
						"paneProperties.legendProperties.showSeriesOHLC": true,
						"mainSeriesProperties.candleStyle.upColor": style.up,
						"mainSeriesProperties.candleStyle.downColor": style.down,
						"mainSeriesProperties.candleStyle.drawWick": true,
						"mainSeriesProperties.candleStyle.drawBorder": true,
						"mainSeriesProperties.candleStyle.borderColor": style.border,
						"mainSeriesProperties.candleStyle.borderUpColor": style.up,
						"mainSeriesProperties.candleStyle.borderDownColor": style.down,
						"mainSeriesProperties.candleStyle.wickUpColor": style.up,
						"mainSeriesProperties.candleStyle.wickDownColor": style.down,
						"mainSeriesProperties.candleStyle.barColorsOnPrevClose": false,
						"mainSeriesProperties.hollowCandleStyle.upColor": style.up,
						"mainSeriesProperties.hollowCandleStyle.downColor": style.down,

						"mainSeriesProperties.hollowCandleStyle.drawWick": true,
						"mainSeriesProperties.hollowCandleStyle.drawBorder": true,
						"mainSeriesProperties.hollowCandleStyle.borderColor": style.border,
						"mainSeriesProperties.hollowCandleStyle.borderUpColor": style.up,
						"mainSeriesProperties.hollowCandleStyle.borderDownColor": style.down,
						"mainSeriesProperties.hollowCandleStyle.wickColor": style.line,
						"mainSeriesProperties.haStyle.upColor": style.up,
						"mainSeriesProperties.haStyle.downColor": style.down,
						"mainSeriesProperties.haStyle.drawWick": true,
						"mainSeriesProperties.haStyle.drawBorder": true,
						"mainSeriesProperties.haStyle.borderColor": style.border,
						"mainSeriesProperties.haStyle.borderUpColor": style.up,
						"mainSeriesProperties.haStyle.borderDownColor": style.down,
						"mainSeriesProperties.haStyle.wickColor": style.border,
						"mainSeriesProperties.haStyle.barColorsOnPrevClose": false,
						"mainSeriesProperties.barStyle.upColor": style.up,
						"mainSeriesProperties.barStyle.downColor": style.down,
						"mainSeriesProperties.barStyle.barColorsOnPrevClose": false,
						"mainSeriesProperties.barStyle.dontDrawOpen": false,
						"mainSeriesProperties.lineStyle.color": style.border,
						"mainSeriesProperties.lineStyle.linewidth": 1,
						"mainSeriesProperties.lineStyle.priceSource": "close",
						"mainSeriesProperties.areaStyle.color1": style.areatop,
						"mainSeriesProperties.areaStyle.color2": style.areadown,
						"mainSeriesProperties.areaStyle.linecolor": style.borders,
						"mainSeriesProperties.areaStyle.linewidth": 1,
						"mainSeriesProperties.areaStyle.priceSource": "close"
					}
				},


				chose() {
					this.widget.setLanguage('en') //设置语言
				},



			},
		})
	</script>
</body>

</html>