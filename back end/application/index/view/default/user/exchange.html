{extend name="public/layout" /}

{block name="addCss"}
<link rel="stylesheet" href="__MB__/element-ui/lib/theme-chalk/index.css" />
<style>
		.content {
			margin: 0 20px;
		}

		.content span {
			display: block;
			width: 60px;
		}

		.content input {
			margin-top: 20px;
			width: 44%;
			border: 1px solid #f1f1f1;
			line-height: 30px;
			padding: 0 10px;
		}

		.password {
			line-height: 40px;
		}

		.password input {
			padding-left: 4px;
		}

		.btns {
			height: 40px;
			line-height: 40px;
			border-radius: 2px;
			background-color: #588bf7;
			margin-top: 40px;
		}

		.btns button {
			width: 100%;
			background-color: rgba(0, 0, 0, 0);
			border: none;
			outline: none;
		}

		#currency {
			padding: 0 10px;
			border: 1px solid #f1f1f1;
			width: 120px;
			line-height: 30px;
			height: 30px;

		}

		.logos {
			width: 20px;
			height: 20px;
			position: relative;
			top: 5px;
			margin-right: 6px;
		}

		.tab-logo {
			width: 30px;
			height: 30px;
			margin-top: 5px;
		}

		.coin-currency-flash {
			padding-bottom: 20px;
		}

		.width1 {
			width: 23%;
		}

		.width2 {
			width: 15%;
		}

		.width3 {
			width: 26.5%;
		}

		.order-list {
			width: 100%;
			margin-top: 10px;
		}

		.order-list ul {
			width: 100%;
			background-color: #fff;
			margin-top: 10px;
		}

		.order-list ul li {
		    word-break: break-all;
			border-bottom: 1px solid #f1f1f1;
			padding: 10px 0;
		}

		.bg {
			background-color: #fff;
			padding-bottom: 10px;
			padding-top: 10px;
			margin-top: 20px;
		}

		.order-list-text {
			width: 100%;
			line-height: 40px;
			background-color: #fff;
			padding-left: 10px;
		}
		.tl{
		    width: 40%;
		    text-align: left;
            border: 1px solid #ddd;
            height: 38px;
            border-radius: 5px;
		}
		.el-dropdown {
		    width: 100%;
            display: inline-block;
            position: relative;
            color: #606266;
            font-size: 14px;
            padding: 10px;
        }
        .el-icon--right{
            margin-left: 65px;
        }
        .line{
            height: 10px;
            background: #f4f8fb;
        }
        .duihuan{
            padding: 20px 3%;
            border-bottom: 1px solid #eee;
        } 
        .duihuan h1{
            color: #90a2b0;
            font-size: 16px;
        }
        .duihuan-row{
            display: flex;
            flex-direction: row;
            margin-top: 20px;
            justify-content: space-between;
        }
        .duihuan-row input{
            width: 55%;
            font-size: 20px;
        }
        .duihuan-row em{
            font-size: 20px;
        }
        .duihuan-row span{
            color: #588bf7;
        }
        .huilv{
            display: flex;
            flex-direction: row;
            margin-top: 15px;
        }
        .huilv article{
            display: flex;
            flex-direction: column;
            text-align: center;
            width: 33.33%;
        }
        .huilv span{
            font-size: 12px;
            color: #90a2b0;
        }
        .huilv em{
            font-size: 12px;
            color: #62759a;
        }
	</style>
{/block}

{block name="content"}
<div  id="app" v-cloak>
   <header class="header">
			<a class="back mt5" href="javascript:history.go(-1)"></a>
			<h4 class="ft16" data-localize="zdy.duihuan">兑换</h4>
			<p class="right jump" data-href="{:url('user/exchange_record')}">
				<img class="recordList" src="__MB__/images/record1.png" alt="" style="width:20px">
			</p>
		</header>
		 		<div class="header-space"></div>
		
		
		<div class="bg" >
			<div class="convertibility-header flex between ml10 mr10 mb10">
				<div class="tl">
					<div class="el-dropdown">
						<span class="el-dropdown-link el-dropdown-selfdefine"
							aria-haspopup="list" aria-controls="dropdown-menu-3861"
							role="button" tabindex="0"> {{value1}}<i
							class="el-icon-arrow-down el-icon--right"></i></span>
						<ul class="el-dropdown-menu el-popper" id="dropdown-menu-3861"
							style="display: none;">
							<li tabindex="-1" class="el-dropdown-menu__item"></li>
							<li tabindex="-1" class="el-dropdown-menu__item"></li>
						</ul>
					</div>
				</div>
				<img
					src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAAAvCAYAAABzJ5OsAAAECElEQVRoQ+2ZT2gcdRTHv9/f2uzMRrSKHipYNGDx3009eLBFQfCgGKKbmYJ/qqCIB0GTWS1EXGNjm5kVDyK0+AcUhFlXklA8FNE29CL0IlSobYUe9GIrJWrZmd1kd55Mkt3ObjbtLux2J5A57rz3fZ/3fr95v9k3RAyvdK58r5LqNwRvgwSTbmbw01aYjCE7DNv7lmS6ziZiuZlUrpk1lvCm438N4PkorAATeUufiv4WT/iPvNtR5TyIoSslEEv4EDh9wNueUDy2JgHBZD6jvxfaxBb+SglAsM/N6O+2hB/+WLYmK4u7ANlBSKqvD7VgO4iXmxkCYk8DvLnfvwPXYRICA8RAX6GvGlxO1uGNXHkEEnxF4Pqr+sXBQGRhGd6wi0+Sag5AIg5c7TAIcJzD2YWtWko7C+LWiFMAke8F6kcw+LsdsZ7ZiHqQlLGmllkh8DhHHX+vAj6M3LxYhTxVsFI/9wyoTeG0s/RwApUjAG6ouQhQochzbiaVp+F4Jwg+VNejpN3x1Hdt6vfMbAW8egSQOjiAJaEy8+PJmeU+bzi+R0BfoeC/bjF5M7IMekbVhnA6t/hAQoKjzeCAMlwrOVuToOn4ElmSM3lLv7sN/Z6aGLY3S3I4EmSpGXy51FF4AKddS7+np2RtiJu2/0XtYBKgTMVRd0w73OwaS/jduf9uEWxxRLAtAOyCpR9tlXMs4ddbnJGp4rYtA2oKEF0x8f6Ggjed0hwgT682l5MbDN7/DUCtoZQ24dtoIF0xMZ3NynelkB2LbFa+45J1yWGz8l0qZMcyrSp/FsBdq6fWjGtpz3Sseo0c1sDvPlC+L0hUJwheKkObmLV44RqxdBxmDfx6Csa0N0KFNwX8vVwsvTWXvemfjqN12aEteMP2XyDx5eVpAnOupVldZulYznT8MwB2rDqW1kzMTNvfA+LzpjHIZ66lv9pxtK46SPgetgDwxhVZudA4MXP8VwAcBKDqcQXnJcGd+TEtfLD7dpm2/wiI4xGA+Tq8uQ54VanHCuPJU32jDgNnRRmDpWMEdtY4RNTeZfg4g6ezMqAGSwcJvBQpoF+V6hBHp4vDVGqGkXG3AEJgn0D6VnERkOQQgRcvn0N1/Kxr6ct/A38FcH9ft0UnwQU//eVpT8xnWQnhKxtmwCr4wRPt2cNv81KYbzgxO0fgzk6S74PtnyLB/ryXOhSd5tGYLr5OpRq+c4Z7PmyZBM73AbQWMpCAFwMV/IIT+olCgdVmltVuU3IAGY/eFODUIrRH4/yuE+nzGy+BhhN21PYcRTasAMDTZSR3xXEFWr3bfABiomELCT/JZ7Q3+rj/W4Zu+SnTtP2GBAQ4lLf01zYEfAg5ansZRY5BcK4aiFF4J/VH3OD/B7m52YL1LMEeAAAAAElFTkSuQmCC"
					alt="" class="tab-logo"  @click="coinTab">
				<div class="tl">
					<div class="el-dropdown">
						<span class="el-dropdown-link el-dropdown-selfdefine "
							aria-haspopup="list" aria-controls="dropdown-menu-7820"
							role="button" tabindex="0"> {{value2}}<i
							class="el-icon-arrow-down el-icon--right"></i></span>
					</div>
				</div>
			</div>
			<div class="line"></div>
			<div class="duihuan">
				<h1 data-localize="zdy.duihuannum">兑换数量</h1>
				<div class="duihuan-row">
					<em>{{value1}}</em> 
					<input type="number" v-model="inputNUm" data-localize="td.pnum" placeholder="请输入数量" @input="jianting()">
					<span data-localize="zdy.allduihuan"  @click="allduihuan()">全部兑换</span>
				</div>
			</div>
			<div class="huilv">
				<article>
					<span data-localize="zdy.huilv">兑换汇率</span> <em>{{leftRate | toFixeds1}}</em>
				</article>
				<article>
					<span><span data-localize="transaction.avaiable">可用</span>{{value1}}</span>
					<em>{{balance | toFixeds1}}</em>
				</article>
				<article>
					<span><span data-localize="zdy.kede">可得</span>{{value2}}</span> <em>{{kedePrice | toFixeds1}}</em>
				</article>
			</div>
			<div class="btns ml12">
				<button type="button" data-localize="jc.exnow"   @click="sumbit()" class="white">立即兑换</button>
			</div>
		</div>
		
</div>		
 
{/block}

{block name="footer"}{/block}

{block name="addJs"}
<script type="text/javascript" src="__MB__/lib/vue.min.js"></script>
 <script>
	var vue = new Vue({
		el: '#app',
		data: {
			selectValue: '',
			currencyName: '',
			value1: 'USDT',
			value2: 'CNY',
			leftList: [],
			rightList: [],
			datas: {},
			leftLogo: '',
			rightLogo: '',
			prices: '',
			inputPrice: '',
			inputNUm: '',
			balance: {$user.usdt},
			rightBalance:{$user.money},
			leftId: 'usdt',
			rightId: 'cny',
			orderList: [],
			typeTab: 1,
			pbPrice:'',
			kedePrice:0,
            leftRate:{:get_config_value('usdt_cny_rate')},
            rightRate:1/{:get_config_value('usdt_cny_rate')},
		},
    	filters: {
			toFixeds: function (value) {
				var vals = iTofixed(value,2);
				return vals;
			},
			toFixeds1: function (value) {
				var vals = iTofixed(value,8);
				return vals;
			},
			toFixed4: function (value) {
				var vals = iTofixed(value,4);
				return vals;
			},
			toFixedNum: function (value) {
				var vals = iTofixed(value,0);
				return vals;
			},
			toFixed1: function (value) {
				var vals = iTofixed(value,1);
				return vals;
			}
		},
		mounted: function () {
			let that = this;
		},
		methods: {
			allduihuan(){
		      if(this.balance * this.leftRate > 0){
		        this.inputNUm = this.balance;
		        this.kedePrice = this.balance*this.leftRate;
		      }
		    },
		    jianting(){
		        this.kedePrice=this.inputNUm*this.leftRate;
		    },
		    coinTab() {
				var that = this;
				let leftRate=that.leftRate;
				let rightRate=that.rightRate;
				let value1=that.value1;
				let value2=that.value2;
				let leftId=that.leftId;
				let rightId=that.rightId;
				let rightBalance=that.rightBalance;
				let balance=that.balance;
				
				that.inputNUm='';
				that.kedePrice='';
				
				that.leftRate=rightRate;
				that.rightRate=leftRate;
				that.balance=rightBalance;
				that.rightBalance=balance;
				that.value1=value2;
				that.value2=value1;
				that.leftId=rightId;
				that.rightId=leftId;
			},
			// 兑换
			sumbit() {
				let that = this;
				if (!that.leftRate) {
					layer_msg(getlg('ptprice'));
					return false;
				}
				if (!that.inputNUm) {
					layer_msg(getlg('ptnum'));
					return false;
				}
				initDatas({
					url: 'user/ajax',
					data: {
						request:'exchange',
						l_currency_id: that.leftId,
						price: that.leftRate,
						num: that.inputNUm,
						r_currency_id: that.rightId,
					},
					type: 'post'
				}, function (res) {
					if (getlg(res.msg))
						layer_msg(getlg(res.msg))
					else layer_msg(res.msg)
					if (res.status) {
						setTimeout(function () {
							location.reload();
						}, 1000);
					}
					
				})

			}
		}
	});
</script>
{/block}